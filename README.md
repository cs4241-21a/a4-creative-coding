# boxes

https://a4-niko-pelletier.glitch.me/

This project is meant to allow a user to create some cool visuals with a bunch of random 3D boxes. I wanted to use three.js and a whole lot of randomness to create something that I thought looked interesting. However, I also wanted a mechanism to save and recreate past visuals despite the randomness, which is why I included a way to enter a seed.

The first main problem I encountered was the desire to have a seeded random number generator, since JS does not provide a way to seed its random number generator natively. The solution to this was pretty simple though, since I was able to find a library for creating seeded random number generators.

Another major problem I encountered was that, when the "Generate" button was clicked multiple times, the webpage would use more memory each time it was clicked. This issue was caused by a memory leak in the way I was using three.js. I used a helper method, `makeInstance`, to create each of the boxes. By using that method, a new material is made every time a new box is made, since each box can have a randomly generated color. However, I did not realize that, when a mesh is removed from the scene, the material it is using is not deleted, since one material can be used by multiple meshes. To solve this problem, I had to loop through all of the cubes and call `dispose()` on each of their materials at the beginning of the `generateScene` function, before the `cubes` array was emptied.

In addition to the webpage using more memory, it would also slow down as the "Generate" button was clicked more and more. This is because the `render` function was inside the `generateScene` function, in addition to the call to `requestAnimationFrame(render)` just outside the `render` function. This means that, every time the "Generate" button was clicked, it would create a new render loop without stopping the old one. This was fixed by moving the `render` function and the call to `requestAnimationFrame(render)` outside the `generateScene` function. This works because there only needs to be one render loop, since the scene and camera used never change. The only thing that changes when "Generate" is clicked are the objects in the scene, not the scene itself.